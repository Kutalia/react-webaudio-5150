(this["webpackJsonpreact-webaudio-5150"]=this["webpackJsonpreact-webaudio-5150"]||[]).push([[0],{256:function(e,t,n){},258:function(e,t,n){},266:function(e,t){},268:function(e,t){},279:function(e,t,n){},503:function(e,t,n){},504:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(248),c=n.n(o),u=(n(256),n(101)),s=n.n(u),l=n(25),d=n(54),p=n(12),f=n(249),g=n(21),b=n(506),j=(n(258),n(35)),O=function(e){e.stopPropagation()},v=n(5),h=function(e){var t,n=e.id,r=e.sourceUrl,i=e.context,o=e.factory,c=e.compiler,u=e.onPluginReady,s=e.pluginNodes,l=Object(a.useState)(s?s[0]:null),d=Object(g.a)(l,2),p=d[0],f=d[1],b=Object(a.useRef)(!1);if(Object(a.useEffect)((function(){o&&i&&c&&!p&&!b.current&&fetch("/react-webaudio-5150/"+r).then((function(e){return e.text()})).then((function(e){b.current=!0,o.compileNode(i,"Pedal_"+n,c,e,"-ftz 2",!1,128).then((function(e){f(e),u([e],r,n)}))}))}),[r,i,o,c,u,n,p,b]),!p)return Object(v.jsx)("div",{children:"Start audio to load the plugin"});var h=p.fDescriptor.filter((function(e){var t=e.type;return"vslider"===t||"hslider"===t}));return Object(v.jsxs)("div",{className:"plugin pedal",children:[Object(v.jsx)("div",{className:"plugin-title",children:null===p||void 0===p||null===(t=p.fJSONDsp)||void 0===t?void 0:t.name}),Object(v.jsx)("div",{className:"knobs-wrapper",onMouseDown:O,children:h.map((function(e){var t=e.address,n=e.init,r=e.label,a=e.min,i=e.max;e.step;return Object(v.jsxs)("div",{className:"knob",children:[Object(v.jsx)("label",{htmlFor:t,children:r.toUpperCase()}),Object(v.jsxs)(j.Knob,{size:50,angleOffset:220,angleRange:280,min:a,max:i,value:n||.01,onChange:function(e){return function(e,t){p.setParamValue(e,t)}(t,e)},children:[Object(v.jsx)(j.Arc,{arcWidth:2.5,color:"#FC5A96",radius:18.75}),Object(v.jsx)(j.Pointer,{width:2.5,radius:20,type:"circle",color:"#180094"}),Object(v.jsx)(j.Value,{marginBottom:20,className:"value"})]})]},t)}))})]})},m=n(144),x=n.n(m);!function(e){e[e.signature=0]="signature",e[e.version=1]="version",e[e.preamp_level=2]="preamp_level",e[e.preamp_bias=3]="preamp_bias",e[e.preamp_Kreg=4]="preamp_Kreg",e[e.preamp_Upor=5]="preamp_Upor",e[e.tonestack_low_freq=6]="tonestack_low_freq",e[e.tonestack_low_band=7]="tonestack_low_band",e[e.tonestack_middle_freq=8]="tonestack_middle_freq",e[e.tonestack_middle_band=9]="tonestack_middle_band",e[e.tonestack_high_freq=10]="tonestack_high_freq",e[e.tonestack_high_band=11]="tonestack_high_band",e[e.amp_level=12]="amp_level",e[e.amp_bias=13]="amp_bias",e[e.amp_Kreg=14]="amp_Kreg",e[e.amp_Upor=15]="amp_Upor",e[e.sag_time=16]="sag_time",e[e.sag_coeff=17]="sag_coeff",e[e.output_level=18]="output_level"}(r||(r={}));var k,y,C="kpp_tubeamp.dsp",P=function(e,t){return e?e.fDescriptor.filter((function(e){return e.type===t})):[]},_=function(e){var t,n=e.id,i=e.context,o=e.factory,c=e.compiler,u=e.onPluginReady,s=e.pluginNodes,l=Object(a.useState)(s?s[1]:null),p=Object(g.a)(l,2),f=p[0],b=p[1],h=Object(a.useState)(),m=Object(g.a)(h,2),k=m[0],y=m[1],_=Object(a.useState)(!1),w=Object(g.a)(_,2),N=w[0],S=w[1],M=Object(a.useRef)(!1);if(Object(a.useEffect)((function(){!f&&o&&i&&c&&!M.current&&(M.current=!0,fetch("/react-webaudio-5150/"+C).then((function(e){return e.text()})).then((function(e){o.compileNode(i,"kpp_tubeamp_"+n,c,e,"-ftz 2",!1,128).then((function(e){e&&b(e)}))})))}),[i,o,c,f,M,n]),Object(a.useEffect)((function(){x.a.initPromise.then((function(){S(!0)}))}),[]),Object(a.useEffect)((function(){i&&f&&!k&&N&&fetch("".concat("/react-webaudio-5150","/tubeAmp_Profiles/v1.0/Modern Metal.tapf")).then((function(e){return e.arrayBuffer()})).then((function(e){var t=0,a=e.slice(0,76);t=76;for(var o=new Uint8Array(a.slice(0,4)),c="TaPf",s=0;s<c.length;s++)if(c.charCodeAt(s)!==o[s])return;var l,p=new Uint32Array(a.slice(4,8))[0];(l=new Float32Array(a).reduce((function(e,t,n){return Object.assign(e,Object(d.a)({},r[n],t))}),{})).signature=c,l.version=p,y(l);var g=e.slice(t,t+12);t+=12;var b=new Int32Array(g),j=b[0],O=4*b[2],v=e.slice(t,t+O);if(t+=O,v.byteLength===O){for(var h=new ConvolverNode(i),m=new x.a(1,j,i.sampleRate,10),k=new Int16Array(v),P=m.processChunk(k),_=new Float32Array(P),w=i.createBuffer(1,P.byteLength/2,i.sampleRate),N=w.getChannelData(0),S=0;S<w.length;S++)N[S]=_[S];h.buffer=w,u([h,f],C,n)}}))}),[i,f,k,u,n,N]),Object(a.useEffect)((function(){var e=P(f,"nentry");k&&e.forEach((function(e){null===f||void 0===f||f.setParamValue(e.address,k[e.label])}))}),[f,k]),!f)return Object(v.jsx)("div",{children:"Start audio to load the plugin"});var F=P(f,"vslider");return Object(v.jsxs)("div",{className:"plugin amp-head",children:[Object(v.jsx)("div",{className:"plugin-title",children:null===f||void 0===f||null===(t=f.fJSONDsp)||void 0===t?void 0:t.name}),Object(v.jsx)("div",{className:"knobs-wrapper",onMouseDown:O,children:F.map((function(e){var t=e.address,n=e.init,r=e.label,a=e.min,i=e.max;e.step;return Object(v.jsxs)("div",{className:"knob",children:[Object(v.jsx)("label",{htmlFor:t,children:r}),Object(v.jsxs)(j.Knob,{size:50,angleOffset:220,angleRange:280,min:a,max:i,className:"styledKnob",value:n||.01,onChange:function(e){return function(e,t){f.setParamValue(e,t)}(t,e)},children:[Object(v.jsx)(j.Arc,{arcWidth:.75}),Object(v.jsx)("circle",{r:"20",cx:"25",cy:"25"}),Object(v.jsx)(j.Pointer,{width:1,height:17.5,radius:5,type:"rect",color:"#fff"})]})]},t)}))})]})},w=(n(279),["center","cone","edge"]),N=["1on-preshigh","1on-pres8","1on-pres5"],S=function(e){var t=e.audioContext,n=e.onCabReady,r=Object(a.useState)(0),i=Object(g.a)(r,2),o=i[0],c=i[1];return Object(a.useEffect)((function(){t&&fetch("".concat("/react-webaudio-5150","/ir/").concat(N[o],".wav")).then((function(e){return e.arrayBuffer()})).then((function(e){t.decodeAudioData(e,(function(e){var r=new ConvolverNode(t);r.buffer=e,n(r)}))}))}),[o,t,n]),Object(v.jsxs)("div",{className:"cabinet",onClick:function(){c((function(e){return e===w.length-1?0:e+1}))},children:[Object(v.jsx)("img",{className:"speaker",alt:"Guitar Speaker",src:"".concat("/react-webaudio-5150","/speaker.png")}),Object(v.jsx)("img",{className:"mic mic--".concat(w[o]),alt:"Microphone",src:"".concat("/react-webaudio-5150","/shure_sm57.png")})]})},M=n(14),F=n.n(M),D=n(6),I=n(250),A=n.n(I),L=(n(503),n(38)),E=n(55),R=n(40),T=n(39),H=n(251),U=n(16).default.div(k||(k=Object(H.a)(["\n    .plugin-port {\n        width: 16px;\n        height: 16px;\n        z-index: 10;\n        background: rgba(0, 0, 0, 0.5);\n        border-radius: 8px;\n        cursor: pointer;\n        &:hover {\n            background: rgba(0, 0, 0, 1);\n        }\n        position: absolute;\n        top: 50%;\n\n        &.port-in {\n            left: 0%;\n        }\n        &.port-out {\n            right: 0%;\n        }\n    }\n"]))),z=function(e){Object(R.a)(n,e);var t=Object(T.a)(n);function n(){return Object(L.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props.node.getPort("In"),t=this.props.node.getPort("Out");return Object(v.jsxs)(U,{children:[this.props.node.plugin,e&&Object(v.jsx)(M.PortWidget,{className:"plugin-port port-in",port:e,engine:this.props.engine}),t&&Object(v.jsx)(M.PortWidget,{className:"plugin-port port-out",port:t,engine:this.props.engine})]})}}]),n}(i.a.Component),K=n(100),W=function(e){Object(R.a)(n,e);var t=Object(T.a)(n);function n(){return Object(L.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"createLinkModel",value:function(){return new K.PathFindingLinkModel}}]),n}(n(29).DefaultPortModel),q=function(e){Object(R.a)(n,e);var t=Object(T.a)(n);function n(e,r){var a;return Object(L.a)(this,n),(a=t.call(this,{type:"plugin"})).plugin=e,a.pluginIndex=r,a.addPort(new W(!0,"In","")),a.addPort(new W(!1,"Out","")),a}return n}(M.NodeModel),B=function(e){Object(R.a)(n,e);var t=Object(T.a)(n);function n(){return Object(L.a)(this,n),t.call(this,"plugin")}return Object(E.a)(n,[{key:"generateReactWidget",value:function(e){return Object(v.jsx)(z,{engine:this.engine,node:e.model})}},{key:"generateModel",value:function(e){return new q(Object(v.jsx)(v.Fragment,{}),0)}}]),n}(D.AbstractReactFactory),J=function(e,t){var n=e.getLinks();Object.keys(n).length>(t?1:0)&&Object.entries(n).forEach((function(e){var n=e[1];n!==t&&n.remove()}))},V=function(e){var t=e.plugins,n=e.setPluginsOrder,r=e.pluginsOrder,i=e.addPlugin,o=Object(a.useState)(),c=Object(g.a)(o,2),u=c[0],s=c[1],d=Object(a.useRef)([]),p=Object(a.useRef)([]);return Object(a.useEffect)((function(){var e=F()({registerDefaultZoomCanvasAction:!1});e.getNodeFactories().registerFactory(new B),s(e)}),[]),Object(a.useEffect)((function(){var e=!A()(p.current,r),a=r&&p.current&&p.current.length<r.length;if(u&&(a||(e||!r)&&d.current!==t)){var i,o=u.getModel(),c=[],s=r?r.length:t.length,f=r?r[r.length-1]:s-1;if(o&&o.getNodes().length-2<s){var g;i=new q(r?t[f]:t[t.length-1],f);var b=o.getNodes().filter((function(e){return e instanceof M.DefaultNodeModel&&"Output"===e.getOptions().name}))[0],j=b.getPort("In"),O=Object.keys(j.getLinks()).length&&Object.entries(j.getLinks())[0][1];O&&J(j);var v=O&&(O.getTargetPort().getNode()===b?O.getSourcePort():O.getTargetPort());c=[i.getPort("Out").link(j)],O&&c.push(v.link(i.getPort("In"))),(g=o).addAll.apply(g,[i].concat(Object(l.a)(c)))}else if(!r){var h,m=[],x=u.getLinkFactories().getFactory(M.PathFindingLinkFactory.NAME);t.forEach((function(e,t){i=new q(e,t),m.push(i),t>0&&c.push(m[t-1].getPort("Out").link(m[t].getPort("In"),x))})),(m=[new M.DefaultNodeModel({name:"Input"})].concat(Object(l.a)(m))).push(new M.DefaultNodeModel({name:"Output"}));var k={eventWillFire:function(e){"entityRemoved"===e.function&&e.stopPropagation()}};m[0].registerListener(k),m[m.length-1].registerListener(k),m.length>2&&(c=[m[0].addPort(new M.DefaultPortModel({name:"Out"})).link(m[1].getPort("In"),x)].concat(Object(l.a)(c))).push(m[m.length-2].getPort("Out").link(m[m.length-1].addPort(new M.DefaultPortModel({name:"In"})),x)),(h=o=new M.DiagramModel).addAll.apply(h,Object(l.a)(m).concat(Object(l.a)(c))),u.setModel(o);var y={eventDidFire:function(e){if("linksUpdated"===e.function){var t=e.link,r=t.getSourcePort();J(r,t),e.isCreated&&t.registerListener({targetPortChanged:function(e){e.port.getParent()===r.getParent()?t.remove():J(e.port,t);var a=function(e,t){for(var n,r,a=[],i=e.getNode(t),o=e.getNodes(),c=0;c<o.length-1;c++){var u;if(!(n=null===(u=i.getPort("Out"))||void 0===u?void 0:u.getLinks())||!Object.keys(n).length)return null;(i=(r=Object.entries(n)[0][1]).getSourcePort().getNode()===i?r.getTargetPort().getNode():r.getSourcePort().getNode())instanceof q&&a.push(i.pluginIndex)}return a}(o,m[0].getID());a&&n(a)}})}}};o.registerListener(y);var C=u.getStateMachine().getCurrentState();C&&(C.dragCanvas.config.allowDrag=!1)}setTimeout((function(){new M.DagreEngine({graph:{rankdir:"LR",ranker:"longest-path",marginx:25,marginy:25},includeLinks:!0}).redistribute(o),u.getLinkFactories().getFactory(M.PathFindingLinkFactory.NAME).calculateRoutingMatrix(),u.repaintCanvas()}),1e3),d.current=t}e&&(p.current=r)}),[t,u,r,n,d]),u&&u.getModel()?Object(v.jsx)("div",{onDrop:function(e){var t=e.dataTransfer.getData("plugin");i(t)},className:"canvas",onDragOver:function(e){return e.preventDefault()},children:Object(v.jsx)(D.CanvasWidget,{className:"canvas",engine:u})}):null},G=function(e){var t=e.plugins;return Object(v.jsx)("div",{children:t.map((function(e,t){return Object(v.jsx)("div",{draggable:!0,onDragStart:function(t){return t.dataTransfer.setData("plugin",e)},children:e},t)}))})};function Z(e){Object.entries(e).map((function(e){return e[1].nodes})).forEach((function(e){e&&e.forEach((function(e){return null===e||void 0===e?void 0:e.disconnect()}))}))}!function(e){e[e.DI=0]="DI",e[e.MIC=1]="MIC"}(y||(y={}));var Q=["kpp_distruction.dsp","kpp_octaver.dsp","kpp_tubeamp.dsp","kpp_fuzz.dsp","kpp_bluedream.dsp"],X={audioContext:null,lineInStreamSource:null,diTrackStreamSource:null,inputMode:null,cabConvolver:null,pluginsHistory:["kpp_distruction.dsp"],plugins:{},pluginsOrder:null,allPluginsTailNode:null,faustCompiler:null,faustFactory:null,faustCode:""};var Y=function(){var e,t=Object(a.useState)(X),n=Object(g.a)(t,2),r=n[0],i=n[1],o=r.audioContext,c=r.lineInStreamSource,u=r.diTrackStreamSource,j=Object(a.useRef)(new Audio);function O(e){return"suspended"===e.state||"running"!==e.state?e.resume():Promise.resolve()}function m(){return(m=Object(f.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.audioContext||new AudioContext({latencyHint:"interactive"}),e.next=3,navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1,latency:0}});case 3:return n=e.sent,e.next=6,O(t);case 6:a=t.createMediaStreamSource(n),i((function(e){return Object(p.a)(Object(p.a)({},e),{},{audioContext:t,lineInStreamSource:a,diTrackStreamSource:u,inputMode:y.MIC})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}switch(Object(a.useEffect)((function(){FaustModule().then((function(e){var t=Faust.createCompiler(Faust.createLibFaust(e)),n=Faust.createMonoFactory();i((function(e){return Object(p.a)(Object(p.a)({},e),{},{faustFactory:n,faustCompiler:t})}))}))}),[]),r.inputMode){case y.DI:e=u;break;case y.MIC:e=c;break;default:e=u||c}var x=Object(a.useCallback)((function(e,t,n){i((function(r){var a,i=((null===(a=Object.entries(r.plugins).filter((function(e){return e[1].source===t})))||void 0===a?void 0:a.map((function(e){return e[1].order})).sort((function(e,t){return t-e})))||[void 0])[0],o=r.pluginsHistory.indexOf(t,"number"===typeof i?i+1:void 0);return o=-1===o?r.pluginsHistory.length:o,Object(p.a)(Object(p.a)({},r),{},{plugins:Object(p.a)(Object(p.a)({},r.plugins),{},Object(d.a)({},n,{order:o,nodes:e,source:t}))})}))}),[]),k=Object(a.useCallback)((function(e){i((function(t){var n;return t.cabConvolver&&t.audioContext&&(null===(n=t.allPluginsTailNode)||void 0===n?void 0:n.node)&&(t.allPluginsTailNode.node.disconnect(t.cabConvolver),t.cabConvolver.disconnect(t.audioContext.destination)),Object(p.a)(Object(p.a)({},t),{},{cabConvolver:e})}))}),[]),C=Object(a.useCallback)((function(e,t,n){return"kpp_tubeamp.dsp"===e?Object(v.jsx)(_,{id:t,compiler:r.faustCompiler,factory:r.faustFactory,context:r.audioContext,onPluginReady:x,pluginNodes:n}):Object(v.jsx)(h,{id:t,sourceUrl:e,compiler:r.faustCompiler,factory:r.faustFactory,context:r.audioContext,onPluginReady:x,pluginNodes:n})}),[r.faustFactory,r.faustCompiler,r.audioContext,x]),P=Object(a.useRef)([]),w=Object(a.useMemo)((function(){return r.pluginsHistory.map((function(e,t){var n;P.current[t]?n=P.current[t]:(n=Object(b.a)(),P.current[t]=n);var a=Object.entries(r.plugins).filter((function(e){return e[0]===n}))[0],i=a?a[1].nodes:void 0;return C(e,n,i)}))}),[C,r.pluginsHistory,r.plugins,P]);Object(a.useEffect)((function(){r.cabConvolver&&r.allPluginsTailNode&&Object.keys(r.allPluginsTailNode).length&&r.audioContext&&(r.cabConvolver.disconnect(),r.allPluginsTailNode.node.connect(r.cabConvolver).connect(r.audioContext.destination))}),[r.cabConvolver,r.allPluginsTailNode,r.audioContext]),Object(a.useEffect)((function(){e&&o&&Object.keys(r.plugins).length===w.length&&Object.entries(r.plugins).filter((function(e){return!!e[1]})).length===w.length&&(Z(r.plugins),O(o).then((function(){var t=Object.entries(r.plugins),n=r.pluginsOrder?r.pluginsOrder.map((function(e){return t.filter((function(t){return t[1].order===e}))[0][1].nodes})):t.map((function(e){return e[1].nodes}));if(!!!n.filter((function(e){return!e})).length){var a=Object(l.a)(n).reverse().reduce((function(e,t,n){var r=t.reduce((function(e,t,n){return 0!==n?e.connect(t):t}),{});return 0===n?r:r.connect(e)}),{}),o=n[0][0];e.connect(o),i((function(e){return Object(p.a)(Object(p.a)({},e),{},{allPluginsTailNode:{node:a}})}))}})))}),[r.plugins,w.length,r.pluginsOrder,e,o]);var N=Object(a.useCallback)((function(e){i((function(t){return Object(p.a)(Object(p.a)({},t),{},{pluginsOrder:e})}))}),[]),M=Object(a.useCallback)((function(e){i((function(t){Z(t.plugins);var n=Object.entries(t.plugins),r=!t.pluginsOrder||t.pluginsHistory.filter((function(n,r){var a;return n===e&&(null===(a=t.pluginsOrder)||void 0===a?void 0:a.includes(r))})).length===n.filter((function(t){return t[1].source===e})).length,a=t.pluginsOrder?[].concat(Object(l.a)(t.pluginsOrder),[r?n.length:n.find((function(n){var r;return n[1].source===e&&!(null===(r=t.pluginsOrder)||void 0===r?void 0:r.includes(n[1].order))}))[1].order]):[].concat(Object(l.a)(n.map((function(e,t){return t}))),[n.length]);return Object(p.a)(Object(p.a)({},t),{},{pluginsHistory:r?[].concat(Object(l.a)(t.pluginsHistory),[e]):t.pluginsHistory,pluginsOrder:a})}))}),[]);return Object(v.jsxs)("div",{className:"App",children:[Object(v.jsxs)("div",{children:["Click ",Object(v.jsx)("button",{disabled:!!c,onClick:function(){return m.apply(this,arguments)},children:"here"})," to turn on your guitar input."]}),Object(v.jsxs)("div",{className:"plugins-wrapper",children:[Object(v.jsx)(G,{plugins:Q}),Object(v.jsx)(V,{plugins:w,pluginsOrder:r.pluginsOrder,setPluginsOrder:N,addPlugin:M})]}),Object(v.jsx)(S,{audioContext:r.audioContext,onCabReady:k}),Object(v.jsx)("div",{children:Object(v.jsx)("audio",{controls:!0,ref:j,onPlay:function(){if(!u){var e=r.audioContext||new AudioContext({latencyHint:"interactive"}),t=j.current;O(e).then((function(){var n=e.createMediaElementSource(t);i((function(t){return Object(p.a)(Object(p.a)({},t),{},{audioContext:e,lineInStreamSource:c,diTrackStreamSource:n,inputMode:y.DI})}))}))}},children:Object(v.jsx)("source",{src:"".concat("/react-webaudio-5150","/di/LasseMagoDI.mp3"),type:"audio/mpeg"})})})]})},$=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,507)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};c.a.render(Object(v.jsx)(Y,{}),document.getElementById("root")),$()}},[[504,1,2]]]);
//# sourceMappingURL=main.9de2435d.chunk.js.map